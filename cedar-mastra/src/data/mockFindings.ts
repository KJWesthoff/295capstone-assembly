import { Finding, Evidence, calculatePriorityScore, calculateFixabilityScore } from "@/types/finding";

export const mockEvidence: Record<string, Evidence> = {
  "ev-001": {
    id: "ev-001",
    authContext: "unauth",
    request: `POST /v1/auth/login HTTP/1.1
Host: api.example.com
Content-Type: application/json

{"username":"admin' OR '1'='1","password":"anything"}`,
    response: `HTTP/1.1 200 OK
Content-Type: application/json

{"token":"eyJhbGc...","userId":1,"role":"admin"}`,
    headers: {
      "Content-Type": "application/json",
      "X-Request-ID": "abc-123",
    },
    pocLinks: ["https://www.exploit-db.com/exploits/50123"],
    redactRules: ["token", "userId"],
  },
  "ev-002": {
    id: "ev-002",
    authContext: "user",
    request: `GET /v1/users/../../etc/passwd HTTP/1.1
Host: api.example.com
Authorization: Bearer token123`,
    response: `HTTP/1.1 200 OK

root:x:0:0:root:/root:/bin/bash`,
    headers: {
      "Authorization": "Bearer [REDACTED]",
    },
    pocLinks: [],
    redactRules: ["Authorization"],
  },
};

const rawFindings: Omit<Finding, "priorityScore" | "fixabilityScore">[] = [
  {
    id: "find-001",
    endpoint: { method: "POST", path: "/v1/auth/login", service: "auth-svc" },
    severity: "Critical",
    cvss: 9.1,
    exploitSignal: 10,
    exploitPresent: true,
    owasp: "API2:2023 — Broken Authentication",
    cwe: ["CWE-287", "CWE-89"],
    cve: ["CVE-2023-12345"],
    scanners: ["VentiAPI", "ZAP"],
    status: "New",
    evidenceId: "ev-001",
    exposure: 10,
    recencyTrend: 10,
    blastRadius: 9,
    firstSeen: "2025-10-15T08:30:00Z",
    lastSeen: "2025-10-16T12:15:00Z",
    owner: "sec-team",
    slaDue: "2025-10-18T23:59:59Z",
    flags: { isNew: true, isRegressed: false, isResolved: false },
    summaryHumanReadable:
      "SQL injection in login endpoint allows authentication bypass. Attacker can gain admin access without credentials using classic SQLi payload.",
    nistCsf: ["Protect", "Detect"],
    nist80053: ["AC-2", "IA-2", "SC-7"],
    repo: "ventiapi/auth-service",
    file: "src/controllers/authController.ts",
    language: "TypeScript",
    framework: "Node/Express",
    suggestedFix: "Use parameterized queries; apply input sanitization with validator.js",
    prStatus: "None",
    testsStatus: "Passing",
  },
  {
    id: "find-002",
    endpoint: { method: "GET", path: "/v1/users/:id", service: "user-svc" },
    severity: "High",
    cvss: 7.5,
    exploitSignal: 0,
    exploitPresent: false,
    owasp: "API1:2023 — Broken Object Level Authorization",
    cwe: ["CWE-639"],
    cve: [],
    scanners: ["VentiAPI", "Nuclei"],
    status: "Open",
    evidenceId: "ev-002",
    exposure: 8,
    recencyTrend: 5,
    blastRadius: 7,
    firstSeen: "2025-10-10T14:22:00Z",
    lastSeen: "2025-10-16T10:05:00Z",
    owner: "dev-team-a",
    slaDue: "2025-10-20T23:59:59Z",
    flags: { isNew: false, isRegressed: true, isResolved: false },
    summaryHumanReadable:
      "Insufficient authorization checks allow users to access other users' data by manipulating the ID parameter.",
    nistCsf: ["Protect"],
    nist80053: ["AC-3", "AC-6"],
    repo: "ventiapi/user-service",
    file: "src/routes/userRoutes.py",
    language: "Python",
    framework: "FastAPI",
    suggestedFix: "Add owner check middleware; validate userId matches session",
    prStatus: "Open",
    testsStatus: "Failing",
  },
  {
    id: "find-003",
    endpoint: { method: "POST", path: "/v1/payments", service: "payment-svc" },
    severity: "Critical",
    cvss: 8.8,
    exploitSignal: 5,
    exploitPresent: true,
    owasp: "API8:2023 — Security Misconfiguration",
    cwe: ["CWE-770"],
    cve: [],
    scanners: ["VentiAPI"],
    status: "In Review",
    evidenceId: "ev-001",
    exposure: 9,
    recencyTrend: 8,
    blastRadius: 10,
    firstSeen: "2025-10-14T09:00:00Z",
    lastSeen: "2025-10-16T11:30:00Z",
    owner: "sec-team",
    slaDue: "2025-10-17T23:59:59Z",
    flags: { isNew: true, isRegressed: false, isResolved: false },
    summaryHumanReadable:
      "No rate limiting on payment endpoint allows attacker to enumerate valid card numbers and drain resources.",
    nistCsf: ["Protect", "Respond"],
    nist80053: ["SC-5", "SI-10"],
    repo: "ventiapi/payment-service",
    file: "src/main/java/PaymentController.java",
    language: "Java",
    framework: "Spring Boot",
    suggestedFix: "Apply rate limiting with bucket4j; add IP-based throttling",
    prStatus: "None",
    testsStatus: "None",
  },
  {
    id: "find-004",
    endpoint: { method: "PUT", path: "/v1/admin/settings", service: "admin-svc" },
    severity: "Medium",
    cvss: 5.3,
    exploitSignal: 0,
    exploitPresent: false,
    owasp: "API5:2023 — Broken Function Level Authorization",
    cwe: ["CWE-284"],
    cve: [],
    scanners: ["Nuclei"],
    status: "Open",
    evidenceId: "ev-002",
    exposure: 6,
    recencyTrend: 3,
    blastRadius: 5,
    firstSeen: "2025-09-20T16:45:00Z",
    lastSeen: "2025-10-16T09:20:00Z",
    owner: "dev-team-b",
    slaDue: "2025-10-25T23:59:59Z",
    flags: { isNew: false, isRegressed: false, isResolved: false },
    summaryHumanReadable:
      "Regular users can access admin-level settings endpoint with proper session token but insufficient role checks.",
    nistCsf: ["Protect"],
    nist80053: ["AC-2", "AC-6"],
    repo: "ventiapi/admin-service",
    file: "src/controllers/settingsController.ts",
    language: "TypeScript",
    framework: "Node/Express",
    suggestedFix: "Add role-based middleware; enforce ADMIN role check",
    prStatus: "Merged",
    testsStatus: "Passing",
  },
  {
    id: "find-005",
    endpoint: { method: "GET", path: "/v1/reports/export", service: "report-svc" },
    severity: "Low",
    cvss: 3.7,
    exploitSignal: 0,
    exploitPresent: false,
    owasp: "API3:2023 — Excessive Data Exposure",
    cwe: ["CWE-200"],
    cve: [],
    scanners: ["VentiAPI", "ZAP"],
    status: "Open",
    evidenceId: "ev-001",
    exposure: 4,
    recencyTrend: 2,
    blastRadius: 3,
    firstSeen: "2025-10-01T11:00:00Z",
    lastSeen: "2025-10-16T08:50:00Z",
    owner: "dev-team-a",
    slaDue: "2025-10-30T23:59:59Z",
    flags: { isNew: false, isRegressed: false, isResolved: false },
    summaryHumanReadable:
      "Export endpoint returns full user objects including sensitive fields that should be filtered on the backend.",
    nistCsf: ["Protect"],
    nist80053: ["SC-8", "AC-4"],
    repo: "ventiapi/report-service",
    file: "src/routes/reportRoutes.py",
    language: "Python",
    framework: "FastAPI",
    suggestedFix: "Use Pydantic response models to whitelist fields; exclude sensitive attrs",
    prStatus: "None",
    testsStatus: "Passing",
  },
];

export const mockFindings: Finding[] = rawFindings.map((f) => {
  const finding = f as Finding;
  return {
    ...finding,
    priorityScore: calculatePriorityScore(finding),
    fixabilityScore: calculateFixabilityScore(finding),
  };
});
